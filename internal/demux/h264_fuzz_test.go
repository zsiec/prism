package demux

import "testing"

func FuzzParseAnnexB(f *testing.F) {
	// Seed with valid Annex B data
	f.Add([]byte{
		0x00, 0x00, 0x00, 0x01, 0x67, 0x42, 0xE0, 0x1E,
		0x00, 0x00, 0x00, 0x01, 0x68, 0xCE, 0x38, 0x80,
		0x00, 0x00, 0x00, 0x01, 0x65, 0x88, 0x84, 0x00, 0xFF, 0xFE,
	})
	f.Add([]byte{0x00, 0x00, 0x01, 0x67, 0x42, 0xE0})
	f.Add([]byte{0x00, 0x00, 0x00, 0x01, 0x41, 0x9A, 0x00, 0x01, 0x02})
	f.Fuzz(func(t *testing.T, data []byte) {
		ParseAnnexB(data) // must not panic
	})
}

func FuzzParseSPS(f *testing.F) {
	f.Add([]byte{
		0x67, 0x64, 0x00, 0x1f, 0xac, 0xd9, 0x40, 0x50,
		0x05, 0xbb, 0xff, 0x00, 0x03, 0x00, 0x04, 0x6a,
		0x02, 0x02, 0x02, 0x80, 0x00, 0x01, 0xf4, 0x80,
		0x00, 0x5d, 0xc0, 0x07, 0x8c, 0x18, 0xcb,
	})
	f.Add([]byte{
		0x67, 0x4d, 0x40, 0x1f, 0xb9, 0x08, 0x08, 0x0c,
		0xd8, 0x0b, 0x50, 0x10, 0x10, 0x14, 0x00, 0x00,
		0x0f, 0xa4, 0x00, 0x02, 0xee, 0x03, 0x81, 0x80,
		0x04, 0x93, 0xc0, 0x02, 0x49, 0xe8, 0xa0, 0xc0,
		0x3a, 0x8e, 0x18, 0xc9,
	})
	f.Fuzz(func(t *testing.T, data []byte) {
		ParseSPS(data) // must not panic
	})
}
